<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candidatos | Innovation.ia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .sidebar-link:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .active-link {
            background: #3b82f6;
            color: white !important;
        }

        /* Mobile Sidebar Overlay */
        #sidebar-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            transition: opacity 0.3s;
        }
    </style>
</head>

<body class="flex h-screen overflow-hidden">

    <!-- MOBILE OVERLAY -->
    <div id="sidebar-overlay" class="fixed inset-0 z-40 hidden opacity-0" onclick="toggleSidebar()"></div>

    <!-- SIDEBAR -->
    <aside id="sidebar"
        class="w-64 bg-white border-r border-gray-200 fixed inset-y-0 left-0 transform -translate-x-full md:translate-x-0 md:relative flex flex-col transition-transform duration-300 ease-in-out z-50">
        <div class="p-6 flex justify-between items-center">
            <span
                class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Innovation.ia</span>
            <button class="md:hidden text-gray-500" onclick="toggleSidebar()">‚úï</button>
        </div>
        <nav class="flex-1 px-4 space-y-2">
            <a href="/dashboard"
                class="sidebar-link flex items-center p-3 rounded-xl transition text-gray-600 hover:text-blue-600">
                <span class="mr-3">üìä</span> Dashboard
            </a>
            <a href="/vagas"
                class="sidebar-link flex items-center p-3 rounded-xl transition text-gray-600 hover:text-blue-600">
                <span class="mr-3">üíº</span> Minhas Vagas
            </a>
            <a href="/candidatos" class="sidebar-link active-link flex items-center p-3 rounded-xl transition">
                <span class="mr-3">üë•</span> Candidatos
            </a>
            <a href="/configuracoes"
                class="sidebar-link flex items-center p-3 rounded-xl transition text-gray-600 hover:text-blue-600">
                <span class="mr-3">‚öôÔ∏è</span> Configura√ß√µes
            </a>
        </nav>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 overflow-y-auto p-4 md:p-8 w-full">
        <!-- MOBILE HEADER -->
        <div class="md:hidden flex items-center mb-6">
            <button onclick="toggleSidebar()" class="text-gray-600 p-2 mr-4 rounded-lg hover:bg-gray-100">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16">
                    </path>
                </svg>
            </button>
            <span class="text-xl font-bold text-gray-800">Candidatos</span>
        </div>

        <header class="hidden md:flex justify-between items-center mb-8">
            <div>
                <h1 class="text-2xl font-bold text-gray-800">Candidatos</h1>
                <p class="text-gray-500 text-sm mt-1">Gerencie os talentos que se aplicaram √†s suas vagas</p>
            </div>
        </header>

        <!-- TABLE -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-gray-50 border-b border-gray-100">
                        <tr class="text-xs uppercase text-gray-500 font-semibold tracking-wider">
                            <th class="px-6 py-4">Nome / Email</th>
                            <th class="px-6 py-4 hidden sm:table-cell">Vaga</th>
                            <th class="px-6 py-4">Score IA</th>
                            <th class="px-6 py-4 hidden sm:table-cell">Status</th>
                            <th class="px-6 py-4 text-right">A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="candidates-table-body" class="divide-y divide-gray-100 text-sm text-gray-700">
                        <tr>
                            <td colspan="5" class="px-6 py-8 text-center text-gray-400">
                                Carregando candidatos...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- Pagination -->
            <div class="px-6 py-4 border-t border-gray-100 flex items-center justify-between text-xs text-gray-500">
                <span>Total de resultados</span>
                <div class="flex gap-2">
                    <button class="px-3 py-1 border rounded hover:bg-gray-50">Anterior</button>
                    <button class="px-3 py-1 border rounded hover:bg-gray-50">Pr√≥xima</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');

            if (sidebar.classList.contains('-translate-x-full')) {
                // Open
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);
            } else {
                // Close
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => overlay.classList.add('hidden'), 300);
            }
        }

        async function loadCandidates() {
            try {
                const response = await fetch('/api/candidates');
                if (!response.ok) throw new Error('Erro ao buscar candidatos');

                const candidates = await response.json();
                const tbody = document.getElementById('candidates-table-body');

                if (candidates.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="5" class="px-6 py-8 text-center text-gray-400">Nenhum candidato encontrado.</td></tr>`;
                    return;
                }

                tbody.innerHTML = candidates.map((c, index) => {
                    // Logic for Score Color
                    let colorClass = 'bg-red-500';
                    let textClass = 'text-red-600';

                    if (c.score >= 80) {
                        colorClass = 'bg-green-500';
                        textClass = 'text-green-600';
                    } else if (c.score >= 50) {
                        colorClass = 'bg-yellow-500';
                        textClass = 'text-yellow-600';
                    }

                    return `
                    <tr class="hover:bg-gray-50 transition duration-150">
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <div class="h-10 w-10 flex-shrink-0 mr-4 bg-gradient-to-br from-blue-100 to-blue-200 rounded-full flex items-center justify-center text-blue-600 font-bold text-sm">
                                    ${c.nome ? c.nome.charAt(0).toUpperCase() : '?'}
                                </div>
                                <div>
                                    <div class="font-semibold text-gray-900">${c.nome || 'Sem Nome'}</div>
                                    <div class="text-xs text-gray-500 truncate max-w-[150px]">${c.email}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 font-medium text-gray-800 hidden sm:table-cell">${c.vaga}</td>
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <span class="font-bold ${textClass} mr-2">${c.score}%</span>
                                <div class="w-24 bg-gray-200 rounded-full h-1.5 hidden sm:block">
                                    <div class="${colorClass} h-1.5 rounded-full" style="width: ${c.score}%"></div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 hidden sm:table-cell">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                ${c.status || 'Novo'}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-right">
                            <button onclick="verPerfil(${c.id})" class="text-indigo-600 hover:text-indigo-900 font-semibold text-sm hover:underline">
                                Ver
                            </button>
                        </td>
                    </tr>
                `}).join('');
            } catch (error) {
                console.error("Erro:", error);
                document.getElementById('candidates-table-body').innerHTML = `
                    <tr><td colspan="5" class="px-6 py-8 text-center text-red-500">Erro ao carregar dados.</td></tr>
                `;
            }
        }

        function verPerfil(id) {
            window.location.href = `/api/candidates/${id}`;
        }

        loadCandidates();
    </script>
</body>

</html>