<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Innovation.ia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .sidebar-link:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .active-link {
            background: #3b82f6;
            color: white !important;
        }

        /* Mobile Overlay */
        #sidebar-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            transition: opacity 0.3s;
        }
    </style>
</head>

<body class="flex h-screen overflow-hidden">

    <!-- MOBILE OVERLAY -->
    <div id="sidebar-overlay" class="fixed inset-0 z-40 hidden opacity-0" onclick="toggleSidebar()"></div>

    <!-- SIDEBAR -->
    <aside id="sidebar"
        class="w-64 bg-white border-r border-gray-200 fixed inset-y-0 left-0 transform -translate-x-full md:translate-x-0 md:relative flex flex-col transition-transform duration-300 ease-in-out z-50">
        <div class="p-6 flex justify-between items-center">
            <span
                class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Innovation.ia</span>
            <button class="md:hidden text-gray-500" onclick="toggleSidebar()">‚úï</button>
        </div>
        <nav class="flex-1 px-4 space-y-2">
            <a href="/dashboard" class="sidebar-link active-link flex items-center p-3 rounded-xl transition">
                <span class="mr-3">üìä</span> Dashboard
            </a>
            <a href="/vagas"
                class="sidebar-link flex items-center p-3 rounded-xl transition text-gray-600 hover:text-blue-600">
                <span class="mr-3">üíº</span> Minhas Vagas
            </a>
            <a href="/candidatos"
                class="sidebar-link flex items-center p-3 rounded-xl transition text-gray-600 hover:text-blue-600">
                <span class="mr-3">üë•</span> Candidatos
            </a>
            <a href="/configuracoes"
                class="sidebar-link flex items-center p-3 rounded-xl transition text-gray-600 hover:text-blue-600">
                <span class="mr-3">‚öôÔ∏è</span> Configura√ß√µes
            </a>
        </nav>
    </aside>

    <!-- CONTENT -->
    <main class="flex-1 overflow-y-auto p-4 md:p-8 w-full">
        <!-- MOBILE HEADER -->
        <div class="md:hidden flex items-center justify-between mb-6">
            <div class="flex items-center">
                <button onclick="toggleSidebar()" class="text-gray-600 p-2 mr-2 rounded-lg hover:bg-gray-100">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                <span class="text-xl font-bold text-gray-800">Dashboard</span>
            </div>
            <button onclick="location.href='/vagas/nova'"
                class="text-blue-600 font-bold text-3xl leading-none px-2">+</button>
        </div>

        <header class="hidden md:flex justify-between items-center mb-8">
            <h1 class="text-2xl font-bold text-gray-800">Vis√£o Geral</h1>
            <button onclick="location.href='/vagas/nova'"
                class="bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-700 transition">
                + Nova Vaga
            </button>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <p class="text-gray-500 text-sm">Vagas Ativas</p>
                <h3 id="stat-jobs" class="text-3xl font-bold text-gray-900">--</h3>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <p class="text-gray-500 text-sm">Candidatos Total</p>
                <h3 id="stat-candidates" class="text-3xl font-bold text-gray-900">--</h3>
            </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <h3 class="font-bold mb-4">Candidaturas por Dia</h3>
                <canvas id="dashboardChart"></canvas>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <h3 class="font-bold mb-4">√öltimos Candidatos</h3>
                <div id="candidates-list" class="space-y-4">
                    <p class="text-gray-400">Carregando...</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            if (sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => overlay.classList.add('hidden'), 300);
            }
        }

        async function loadDashboardData() {
            try {
                // Mock Fetch Stats
                const jobsResponse = await fetch('/api/dashboard-stats');
                if (jobsResponse.ok) {
                    const stats = await jobsResponse.json();
                    if (stats.vagas_ativas) document.getElementById('stat-jobs').innerText = stats.vagas_ativas;
                    if (stats.total_candidatos) document.getElementById('stat-candidates').innerText = stats.total_candidatos;
                } else {
                    const response = await fetch('/api/jobs');
                    if (response.ok) {
                        const jobs = await response.json();
                        document.getElementById('stat-jobs').innerText = jobs.length;
                    }
                }

                // Fetch Candidates (Simulate recent applications)
                const candidatesResponse = await fetch('/api/candidatos');
                if (candidatesResponse.ok) {
                    const candidatesAll = await candidatesResponse.json();
                    // Take last 3
                    const candidates = candidatesAll.slice(0, 3);
                    const list = document.getElementById('candidates-list');

                    if (candidates.length === 0) list.innerHTML = '<p class="text-gray-500 text-sm">Sem candidaturas recentes.</p>';
                    else {
                        list.innerHTML = candidates.map(c => `
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <div>
                                    <span class="block font-medium text-gray-900 line-clamp-1">${c.nome || 'An√¥nimo'}</span>
                                    <span class="text-xs text-gray-500">para <strong>${c.vaga}</strong></span>
                                </div>
                                <span class="text-xs font-bold ${c.score >= 80 ? 'text-green-600' : 'text-gray-500'}">${c.score || 0}% Match</span>
                            </div>
                        `).join('');
                    }
                }

                const ctx = document.getElementById('dashboardChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex'],
                        datasets: [{
                            label: 'Candidaturas',
                            data: [5, 8, 12, 4, 9], // Mock 
                            borderColor: 'rgb(59, 130, 246)',
                            tension: 0.4
                        }]
                    },
                    options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
                });

            } catch (e) { console.error(e); }
        }
        loadDashboardData();
    </script>
</body>

</html>